<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>2016 Palo Alto Labyrenth CTF Doc 02 | Crazy Dave&#39;s InterTube Emporium</title>
  <meta name="author" content="Crazy Dave">
  
  <meta name="description" content="DOC 01
DOC 02 &amp;lt;- You are here
DOC 03
DOC 04
DOC 05 

So we solved the frist document and then they give us this…Document #2 (hash: ACCDF64EB1E96BE5">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="2016 Palo Alto Labyrenth CTF Doc 02"/>
  <meta property="og:site_name" content="Crazy Dave&#39;s InterTube Emporium"/>

  
    <meta property="og:image" content="undefined"/>
  

  
    <link rel="alternative" href="/atom.xml" title="Crazy Dave&#39;s InterTube Emporium" type="application/atom+xml">
  
  
    <link href="/favicon.png" rel="icon">
  

  <!-- CSS -->
  <link rel="stylesheet" href="/css/themes/cyborg.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  



</head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
	<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
       <a class="navbar-brand" href="/">Crazy Dave&#39;s InterTube Emporium</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class="archive"></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/categories" title="All the categories.">
			  <i class="folder"></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="/tags" title="All the tags.">
			  <i class="tags"></i>Tags
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class="user"></i>About
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header page-header-inverse ">		
			<h1 class="title title-inverse "> 2016 Palo Alto Labyrenth CTF Doc 02</h1>
		</div>		
	






<div class="row post">
	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  		

	  <ul>
<li><a href="/2016/08/15/2016-Palo-Alto-Labyrenth-CTF-Doc-01/">DOC 01</a></li>
<li><a href="/2016/08/15/2016-Palo-Alto-Labyrenth-CTF-Doc-02/">DOC 02</a> &lt;- You are here</li>
<li><a href="/2016/08/15/2016-Palo-Alto-Labyrenth-CTF-Doc-03/">DOC 03</a></li>
<li><a href="/2016/08/15/2016-Palo-Alto-Labyrenth-CTF-Doc-04/">DOC 04</a></li>
<li><a href="/2016/08/15/2016-Palo-Alto-Labyrenth-CTF-Doc-05/">DOC 05</a> </li>
</ul>
<p>So we solved the frist document and then they give us this…Document #2 (hash: <a href="/data/PAN_CTF_DOCTrack_002.zip">ACCDF64EB1E96BE5A7C5F23DB6A74B88869E4F6C3B46D41F80B3063BF79AD05E</a>)</p>
<p>So again, run it through <a href="https://github.com/DBHeise/fileid" target="_blank" rel="external">FileId</a> tool and get the VBA code out (using the XML or JSON output options).</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">Sub AutoOpen()</div><div class="line">&apos;</div><div class="line">&apos; crackme Macro</div><div class="line">&apos;</div><div class="line">&apos;</div><div class="line">    UserForm1.Show</div><div class="line">End Sub</div></pre></td></tr></table></figure>
<p>and<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">Private Sub button_Click()</div><div class="line">    x = suchcrypto(key.Text, &quot;General Vidal&quot;)</div><div class="line">    If x = &quot;171,184,42,184,88,26,47,154,20,219,203,130,52,19,180,214,156,94,186,74,30,248,119,235,139,130,175,141,179,197,8,204,252,&quot; Then</div><div class="line">        MsgBox &quot;Wow. Good Job! Such crack.&quot;</div><div class="line">    Else</div><div class="line">        MsgBox &quot;U can do. Try harder...&quot;</div><div class="line">    End If</div><div class="line">End Sub</div><div class="line"></div><div class="line">Function suchcrypto(sMessage, strKey)</div><div class="line">    Dim kLen, x, y, i, j, temp</div><div class="line">    Dim s(256), k(256)</div><div class="line">    kLen = Len(strKey)</div><div class="line">    For i = 0 To 255</div><div class="line">        s(i) = i</div><div class="line">        k(i) = Asc(Mid(strKey, (i Mod kLen) + 1, 1))</div><div class="line">    Next</div><div class="line">    j = 0</div><div class="line">    For i = 0 To 255</div><div class="line">        j = (j + k(i) + s(i)) Mod 256</div><div class="line">        temp = s(i)</div><div class="line">        s(i) = s(j)</div><div class="line">        s(j) = temp</div><div class="line">    Next</div><div class="line">    x = 0</div><div class="line">    y = 0</div><div class="line">    For i = 1 To 3072</div><div class="line">        x = (x + 1) Mod 256</div><div class="line">        y = (y + s(x)) Mod 256</div><div class="line">        temp = s(x)</div><div class="line">        s(x) = s(y)</div><div class="line">        s(y) = temp</div><div class="line">    Next</div><div class="line">    For i = 1 To Len(sMessage)</div><div class="line">        x = (x + 1) Mod 256</div><div class="line">        y = (y + s(x)) Mod 256</div><div class="line">        temp = s(x)</div><div class="line">        s(x) = s(y)</div><div class="line">        s(y) = temp</div><div class="line"> </div><div class="line">        suchcrypto = suchcrypto &amp; (s((s(x) + s(y)) Mod 256) Xor Asc(Mid(sMessage, i, 1))) &amp; &quot;,&quot;</div><div class="line">    Next</div><div class="line">End Function</div></pre></td></tr></table></figure></p>
<p>ok, so we show a form, get user input and then run the “<code>button_Click</code>“ subroutine…but look, we know what the answer should be when we read the IF statement. So basic algebra here…we know one of the two inputs, we have the function, and we know the output….we can brute force…</p>
<p>ugh, brute forcing…and in VBA…ok if I have to…<em>sigh</em>. In retrospect, I can think of several other ways to attack this “crypto” other than brute forcing, but that’s what I did in the moment.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">Sub BruteEnForcer()</div><div class="line">    ans = &quot;171,184,42,184,88,26,47,154,20,219,203,130,52,19,180,214,156,94,186,74,30,248,119,235,139,130,175,141,179,197,8,204,252,&quot;</div><div class="line">    k = &quot;General Vidal&quot;</div><div class="line"></div><div class="line">    msg = &quot;&quot;</div><div class="line">    Do</div><div class="line">    </div><div class="line">    Loop Until suchcrypto(msg, k) = ans</div><div class="line"></div><div class="line">End Sub</div></pre></td></tr></table></figure></p>
<p>ok, so now we have a simple logic/programming problem. We know what the result will be, but how can we figure out what the msg variable should be. How do we know when we are even close…are we going to iterate over all possible typable strings until we find a match? No, well we could, but no just no. You’ll notice there are a bunch of comma’s in the ‘answer’ string and based on the ‘decyption’ code it appends a comma after iterating over each letter in the message. So lets make that answer an array and go character by character until we get matches. I’m also going to limit it to alphanumeric characters, unless that doesn’t work. I would post by brute forcing code that I used, but I didn’t save it…so here’s some code that <em>might</em> work:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">Sub BruteEnForcer()</div><div class="line">    ans = &quot;171,184,42,184,88,26,47,154,20,219,203,130,52,19,180,214,156,94,186,74,30,248,119,235,139,130,175,141,179,197,8,204,252,&quot;</div><div class="line">    k = &quot;General Vidal&quot;</div><div class="line">    </div><div class="line">    ansArry = Split(ans, &quot;,&quot;)</div><div class="line">    </div><div class="line">    msg = &quot;&quot;</div><div class="line">    leng = 1</div><div class="line">    Do</div><div class="line">        For i = 32 To 126</div><div class="line">            tmpMsg = msg + Chr(i)</div><div class="line">            tmp = Split(suchcrypto(tmpMsg, k), &quot;,&quot;)</div><div class="line">            If tmp(leng) = ansArry(leng) Then</div><div class="line">                msg = tmpMsg</div><div class="line">                leng = leng + 1</div><div class="line">                Exit For</div><div class="line">            End If</div><div class="line">        Next i</div><div class="line">    Loop Until suchcrypto(msg, k) = ans</div><div class="line">    MsgBox msg</div><div class="line">End Sub</div></pre></td></tr></table></figure></p>
<p>which when run gives us the following output:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">PAN&#123;L4$t_Night_@f@iry_Vizited_M3&#125;</div></pre></td></tr></table></figure></p>
<p>gee that looks like it might be it…</p>
<p>BOOM</p>
<p>and we move on to doc #3</p>
	  
	</div>

	<div>
  	<center>
	<div class="pagination">
<ul class="pagination">
	 
				
    	<li class="prev"><a href="/2016/08/15/2016-Palo-Alto-Labyrenth-CTF-Doc-03/" class="alignleft prev"><i class="fa fa-arrow-circle-o-left"></i>Prev</a></li>
  		

        <li><a href="/archives"><i class="fa fa-archive"></i>Archive</a></li>

		
		   <li class="next"><a href="/2016/08/15/2016-Palo-Alto-Labyrenth-CTF-Doc-01/" class="alignright next">Next<i class="fa fa-arrow-circle-o-right"></i></a></li>         
        
	
</ul>
</div>

    </center>
	</div>

    <!-- share -->
    
        

        

    
	
	<!-- comment -->
	
<section id="comment">
  <h2 class="title">Comments</h2>

  
</section>

	</div> <!-- col-md-9/col-md-12 -->
		
	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2016-08-15 
	</div>
	

	<!-- categories -->
    

	<!-- tags -->
	
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#tags"><i class="fa fa-tags"></i></a>		  
    <ul id="tags" class="tag_box list-unstyled collapse in">	  
	    
  <li><a href="/tags/security/">security<span>5</span></a></li> <li><a href="/tags/CTF/">CTF<span>5</span></a></li> <li><a href="/tags/maldoc/">maldoc<span>5</span></a></li> <li><a href="/tags/Labyrenth/">Labyrenth<span>5</span></a></li>
    </ul>
	</div>
		

	<!-- toc -->
	<div class="meta-widget">
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

	</div>
		

</div><!-- row -->



	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  &copy; 2016 Crazy Dave
     
</p> </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>▲</span> 
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

</body>
   </html>
