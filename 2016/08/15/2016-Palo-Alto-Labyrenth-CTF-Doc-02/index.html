<!DOCTYPE HTML>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>2016 Palo Alto Labyrenth CTF Doc 02 | Crazy Dave&#39;s InterTube Emporium</title>
  <meta name="author" content="Crazy Dave">
  
  <meta name="description" content="DOC 01
DOC 02 &amp;lt;- You are here
DOC 03
DOC 04
DOC 05 

So we solved the frist document and then they give us this…Document #2 (hash: ACCDF64EB1E96BE5">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="2016 Palo Alto Labyrenth CTF Doc 02">
  <meta property="og:site_name" content="Crazy Dave&#39;s InterTube Emporium">

  
    <meta property="og:image" content="undefined">
  

  
    <link rel="alternative" href="/atom.xml" title="Crazy Dave&#39;s InterTube Emporium" type="application/atom+xml">
  
  
    <link href="/favicon.png" rel="icon">
  

  <!-- CSS -->
  <link rel="stylesheet" href="/css/themes/cyborg.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  



</head>
</html>
 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
	<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
       <a class="navbar-brand" href="/">Crazy Dave&#39;s InterTube Emporium</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class="archive"></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/categories" title="All the categories.">
			  <i class="folder"></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="/projects" title="Past, Present, and Future Projects">
			  <i class="folder"></i>Projects
			</a>
		  </li>
		  
		  <li>
			<a href="/tags" title="All the tags.">
			  <i class="tags"></i>Tags
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class="user"></i>About
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header page-header-inverse ">		
			<h1 class="title title-inverse "> 2016 Palo Alto Labyrenth CTF Doc 02</h1>
		</div>		
	






<div class="row post">
	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  		

	  <ul>
<li><a href="/2016/08/15/2016-Palo-Alto-Labyrenth-CTF-Doc-01/">DOC 01</a></li>
<li><a href="/2016/08/15/2016-Palo-Alto-Labyrenth-CTF-Doc-02/">DOC 02</a> &lt;- You are here</li>
<li><a href="/2016/08/15/2016-Palo-Alto-Labyrenth-CTF-Doc-03/">DOC 03</a></li>
<li><a href="/2016/08/15/2016-Palo-Alto-Labyrenth-CTF-Doc-04/">DOC 04</a></li>
<li><a href="/2016/08/15/2016-Palo-Alto-Labyrenth-CTF-Doc-05/">DOC 05</a> </li>
</ul>
<p>So we solved the frist document and then they give us this…Document #2 (hash: <a href="/data/PAN_CTF_DOCTrack_002.zip">ACCDF64EB1E96BE5A7C5F23DB6A74B88869E4F6C3B46D41F80B3063BF79AD05E</a>)</p>
<p>So again, run it through <a href="https://github.com/DBHeise/fileid" target="_blank" rel="noopener">FileId</a> tool and get the VBA code out (using the XML or JSON output options).</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Sub AutoOpen()</span><br><span class="line">&apos;</span><br><span class="line">&apos; crackme Macro</span><br><span class="line">&apos;</span><br><span class="line">&apos;</span><br><span class="line">    UserForm1.Show</span><br><span class="line">End Sub</span><br></pre></td></tr></table></figure>
<p>and<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">Private Sub button_Click()</span><br><span class="line">    x = suchcrypto(key.Text, &quot;General Vidal&quot;)</span><br><span class="line">    If x = &quot;171,184,42,184,88,26,47,154,20,219,203,130,52,19,180,214,156,94,186,74,30,248,119,235,139,130,175,141,179,197,8,204,252,&quot; Then</span><br><span class="line">        MsgBox &quot;Wow. Good Job! Such crack.&quot;</span><br><span class="line">    Else</span><br><span class="line">        MsgBox &quot;U can do. Try harder...&quot;</span><br><span class="line">    End If</span><br><span class="line">End Sub</span><br><span class="line"></span><br><span class="line">Function suchcrypto(sMessage, strKey)</span><br><span class="line">    Dim kLen, x, y, i, j, temp</span><br><span class="line">    Dim s(256), k(256)</span><br><span class="line">    kLen = Len(strKey)</span><br><span class="line">    For i = 0 To 255</span><br><span class="line">        s(i) = i</span><br><span class="line">        k(i) = Asc(Mid(strKey, (i Mod kLen) + 1, 1))</span><br><span class="line">    Next</span><br><span class="line">    j = 0</span><br><span class="line">    For i = 0 To 255</span><br><span class="line">        j = (j + k(i) + s(i)) Mod 256</span><br><span class="line">        temp = s(i)</span><br><span class="line">        s(i) = s(j)</span><br><span class="line">        s(j) = temp</span><br><span class="line">    Next</span><br><span class="line">    x = 0</span><br><span class="line">    y = 0</span><br><span class="line">    For i = 1 To 3072</span><br><span class="line">        x = (x + 1) Mod 256</span><br><span class="line">        y = (y + s(x)) Mod 256</span><br><span class="line">        temp = s(x)</span><br><span class="line">        s(x) = s(y)</span><br><span class="line">        s(y) = temp</span><br><span class="line">    Next</span><br><span class="line">    For i = 1 To Len(sMessage)</span><br><span class="line">        x = (x + 1) Mod 256</span><br><span class="line">        y = (y + s(x)) Mod 256</span><br><span class="line">        temp = s(x)</span><br><span class="line">        s(x) = s(y)</span><br><span class="line">        s(y) = temp</span><br><span class="line"> </span><br><span class="line">        suchcrypto = suchcrypto &amp; (s((s(x) + s(y)) Mod 256) Xor Asc(Mid(sMessage, i, 1))) &amp; &quot;,&quot;</span><br><span class="line">    Next</span><br><span class="line">End Function</span><br></pre></td></tr></table></figure></p>
<p>ok, so we show a form, get user input and then run the “<code>button_Click</code>“ subroutine…but look, we know what the answer should be when we read the IF statement. So basic algebra here…we know one of the two inputs, we have the function, and we know the output….we can brute force…</p>
<p>ugh, brute forcing…and in VBA…ok if I have to…<em>sigh</em>. In retrospect, I can think of several other ways to attack this “crypto” other than brute forcing, but that’s what I did in the moment.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Sub BruteEnForcer()</span><br><span class="line">    ans = &quot;171,184,42,184,88,26,47,154,20,219,203,130,52,19,180,214,156,94,186,74,30,248,119,235,139,130,175,141,179,197,8,204,252,&quot;</span><br><span class="line">    k = &quot;General Vidal&quot;</span><br><span class="line"></span><br><span class="line">    msg = &quot;&quot;</span><br><span class="line">    Do</span><br><span class="line">    </span><br><span class="line">    Loop Until suchcrypto(msg, k) = ans</span><br><span class="line"></span><br><span class="line">End Sub</span><br></pre></td></tr></table></figure></p>
<p>ok, so now we have a simple logic/programming problem. We know what the result will be, but how can we figure out what the msg variable should be. How do we know when we are even close…are we going to iterate over all possible typable strings until we find a match? No, well we could, but no just no. You’ll notice there are a bunch of comma’s in the ‘answer’ string and based on the ‘decyption’ code it appends a comma after iterating over each letter in the message. So lets make that answer an array and go character by character until we get matches. I’m also going to limit it to alphanumeric characters, unless that doesn’t work. I would post by brute forcing code that I used, but I didn’t save it…so here’s some code that <em>might</em> work:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Sub BruteEnForcer()</span><br><span class="line">    ans = &quot;171,184,42,184,88,26,47,154,20,219,203,130,52,19,180,214,156,94,186,74,30,248,119,235,139,130,175,141,179,197,8,204,252,&quot;</span><br><span class="line">    k = &quot;General Vidal&quot;</span><br><span class="line">    </span><br><span class="line">    ansArry = Split(ans, &quot;,&quot;)</span><br><span class="line">    </span><br><span class="line">    msg = &quot;&quot;</span><br><span class="line">    leng = 1</span><br><span class="line">    Do</span><br><span class="line">        For i = 32 To 126</span><br><span class="line">            tmpMsg = msg + Chr(i)</span><br><span class="line">            tmp = Split(suchcrypto(tmpMsg, k), &quot;,&quot;)</span><br><span class="line">            If tmp(leng) = ansArry(leng) Then</span><br><span class="line">                msg = tmpMsg</span><br><span class="line">                leng = leng + 1</span><br><span class="line">                Exit For</span><br><span class="line">            End If</span><br><span class="line">        Next i</span><br><span class="line">    Loop Until suchcrypto(msg, k) = ans</span><br><span class="line">    MsgBox msg</span><br><span class="line">End Sub</span><br></pre></td></tr></table></figure></p>
<p>which when run gives us the following output:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PAN&#123;L4$t_Night_@f@iry_Vizited_M3&#125;</span><br></pre></td></tr></table></figure></p>
<p>gee that looks like it might be it…</p>
<p>BOOM</p>
<p>and we move on to doc #3</p>
	  
	</div>

	<div>
  	<center>
	<div class="pagination">
<ul class="pagination">
	 
				
    	<li class="prev"><a href="/2016/08/15/2016-Palo-Alto-Labyrenth-CTF-Doc-03/" class="alignleft prev"><i class="fa fa-arrow-circle-o-left"></i>Prev</a></li>
  		

        <li><a href="/archives"><i class="fa fa-archive"></i>Archive</a></li>

		
		   <li class="next"><a href="/2016/08/15/2016-Palo-Alto-Labyrenth-CTF-Doc-01/" class="alignright next">Next<i class="fa fa-arrow-circle-o-right"></i></a></li>         
        
	
</ul>
</div>

    </center>
	</div>

    <!-- share -->
    
        

        

    
	
	<!-- comment -->
	
<section id="comment">
  <h2 class="title">Comments</h2>

  
</section>

	</div> <!-- col-md-9/col-md-12 -->
		
	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2016-08-15 
	</div>
	

	<!-- categories -->
    

	<!-- tags -->
	
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#tags"><i class="fa fa-tags"></i></a>		  
    <ul id="tags" class="tag_box list-unstyled collapse in">	  
	    
  <li><a href="/tags/security/">security<span>5</span></a></li> <li><a href="/tags/CTF/">CTF<span>5</span></a></li> <li><a href="/tags/maldoc/">maldoc<span>5</span></a></li> <li><a href="/tags/Labyrenth/">Labyrenth<span>6</span></a></li>
    </ul>
	</div>
		

	<!-- toc -->
	<div class="meta-widget">
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

	</div>
		

</div><!-- row -->



	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  &copy; 2018 Crazy Dave
     
</p> </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>▲</span> 
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 




   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

</body>
   </html>
